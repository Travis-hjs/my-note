<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width"/>
        <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
        <title>滚动事件</title>
        <link rel="stylesheet" href="./css/base.css">
        <style media="screen">
            .app li{ background-color: gold; height: 5rem; position: relative; z-index: 10; }
            .app li:nth-child(even){ background-color: #212121; }
        </style>
    </head>
    <body>
        <div class="app">
            <ul></ul>
        </div>
        <script>
            let _html = '';
            for (let i = 0; i < 20; i++) {
                _html += '<li></li>'
            }
            document.querySelector('.app ul').innerHTML = _html;

            /**
             * 监听到达底部
             * @param {number} distance 距离底部多少像素触发(像素)
             * @param {Function} callback 到达底部回调函数
             * @param {boolean} once 是否为一次性
             */
            function onBottom(distance = 0, callback, once = false) {
                function onScroll() {
                    let { scrollTop, scrollHeight } = document.scrollingElement;
                    let clientHeight = window.innerHeight;
                    // 当前滚动高度 + 视口高度 >= 文档总高度
                    if (scrollTop + clientHeight >= scrollHeight - distance) {
                        if (typeof callback === 'function') callback();
                        if (once) window.removeEventListener('scroll', onScroll);
                    }
                }
                window.addEventListener('scroll', onScroll);
            }

            /**
             * 监听滚动到底部事件
             * @param {number} number 距离底部多少像素触发(像素)
             * @param {Function} callback 到达底部回调函数
             * @param {boolean} once 是否为一次性（防止重复用）
             */
            function scrollToBottom(number = 0, callback, once = false) {
                // 滚动事件
                function isScroll() {
                    /** 滚动的高度 */
                    let scrollTop = document.documentElement.scrollTop === 0 ? document.body.scrollTop : document.documentElement.scrollTop;
                    /** 滚动条高度 */
                    let scrollHeight = document.documentElement.scrollTop === 0 ? document.body.scrollHeight : document.documentElement.scrollHeight;
                    if (scrollHeight - scrollTop - number <= window.innerHeight) {
                        if (typeof callback === 'function') callback();
                        if (once) window.removeEventListener('scroll', isScroll);
                    }
                }
                window.addEventListener('scroll', isScroll);
            }

            scrollToBottom(100, function () {
                console.log('到底底部~');
            }, true);
        </script>
    </body>
</html>
